# ユーザー管理機能仕様 (User Editor Feature Specification)

## 1. 概要 (Overview)

管理者がユーザーを追加/編集/削除できるようにする。専用のユーザー管理画面で CRUD 操作を提供し、ユーザー管理要件を満たす。

## 2. ユーザーシナリオとテスト (User Scenarios & Testing)

### 主要シナリオ
- **シナリオ1**: 管理者がユーザー管理にアクセス
  - 管理者がログイン後、主画面で「ユーザー管理」を選択
  - ユーザー管理画面が開く
  - 追加/更新/削除の操作領域を持つ

- **シナリオ2**: 管理者がユーザーを追加
  - 入力欄にユーザー名、パスワード、ロールを入力
  - 「追加」を押下
  - 入力検証後に DB へ追加
  - テーブルに新規ユーザーが表示される

- **シナリオ3**: 管理者がユーザーを更新
  - テーブルで対象ユーザーをダブルクリック
  - 入力欄に値が自動反映
  - 変更後に「更新」を押下
  - DB とテーブルが更新される

- **シナリオ4**: 管理者がユーザーを削除
  - 対象ユーザーを選択
  - 「削除」を押下
  - 確認ダイアログを表示
  - 確認後に DB から削除

### テストケース
- 管理者がユーザー追加に成功する
- 管理者がユーザー更新に成功する
- 管理者がユーザー削除に成功する
- ダブルクリックで編集欄に反映される
- 入力検証が正しく動作する
- 管理者以外がアクセスできない

## 3. 機能要件 (Functional Requirements)

### FR1: 主画面の入口
- 主画面に「ユーザー管理」ボタンを表示
- 管理者ロールのみ表示
- クリックでユーザー管理画面を開く

### FR2: 管理画面
- 専用のユーザー管理画面を提供し、以下を含む：
  - 上部：追加/更新/削除ボタン
  - 中部：ユーザー名/パスワード/ロール入力欄
  - 下部：ユーザー一覧テーブル
- 多言語表示に対応

### FR3: 追加機能
- ユーザー追加に対応
- 必須項目（ユーザー名/パスワード/ロール）を入力
- 入力検証を実施
- パスワードはハッシュ化して保存
- 追加後に即時反映

### FR4: 更新機能
- 既存ユーザーの更新に対応
- テーブルのダブルクリックで入力欄に反映
- 入力検証を実施
- 更新結果を即時反映

### FR5: 削除機能
- ユーザー削除に対応
- 削除前に確認ダイアログを表示
- 現在ログイン中の管理者の削除は禁止

### FR6: テーブル操作
- テーブルは ID/ユーザー名/ロール/作成日時を表示
- ダブルクリックで編集欄に反映
- 大量データでもスクロール可能

## 4. 非機能要件 (Non-Functional Requirements)

### NFR1: セキュリティ (Security)
- パスワードは bcrypt 等でハッシュ保存
- 管理者のみユーザー管理にアクセス可能
- 操作ログを記録

### NFR2: 信頼性 (Reliability)
- ユーザーデータの整合性を保証
- 併行操作でもデータ破損を防止

### NFR3: 可用性 (Usability)
- 直感的で理解しやすい UI
- 適切なエラーと確認メッセージ

### NFR4: 性能 (Performance)
- 大量ユーザーでもテーブルが高速に表示
- 追加/更新/削除が 2 秒以内

## 5. 成功基準 (Success Criteria)

- [ ] 3 回以内の操作でユーザー管理に到達
- [ ] 追加操作が 30 秒以内
- [ ] 更新操作が 20 秒以内
- [ ] 削除操作が 15 秒以内
- [ ] UI 応答が 500ms 未満
- [ ] 1000 件のユーザーでも 3 秒以内に表示
- [ ] ダブルクリック反映が 200ms 未満
- [ ] 非管理者は入口を閲覧/起動できない

## 6. 主要エンティティ (Key Entities)

- **ユーザー (User)**：ID/ユーザー名/パスワードハッシュ/ロール
- **権限 (Permission)**：ロール別アクセス権限

## 7. 依存関係と前提 (Dependencies & Assumptions)

### 依存関係
- 既存の認証機構
- 既存の権限制御
- SQLite（単機配布、DB とアプリが同一端末）

### 前提
- 管理者が正常にログイン済み
- DB 接続が正常
- ユーザーテーブルが存在

## 8. エッジケース (Edge Cases)

- 最後の管理者を削除しようとした場合は拒否
- 大量ユーザーでも表示/検索が動作
- ユーザー名重複時はエラー表示
- DB がロック/書込不可の場合はエラー表示し整合性維持
- 不正入力時は明確なエラーメッセージを表示

## 9. 合意済み事項 (Clarifications)

### 2025-11-25 会議決定
- **Q**: パスワード暗号化方式は？
  - **A**: bcrypt によるハッシュを使用
