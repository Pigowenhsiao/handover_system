# 電子引き継ぎシステム機能仕様 (Electronic Handover System Feature Specification)

## 1. 概要 (Overview)

本システムは単機デスクトップアプリ（Tkinter）です。日/中/英の切替に対応し、日報入力、出勤記録、設備異常、異常ロット、出勤統計、異常履歴照会、Delay List と Summary Actual のインポート/アップロード、および管理機能を提供します。全データはローカル SQLite に保存され、ネットワークは不要です。

## 2. ユーザーシナリオとテスト (User Scenarios & Testing)

### 主要シナリオ
- **シナリオ1**: ログインして言語を切替
  - ログイン画面で言語を切替でき、即時反映される
  - ログイン成功後に主画面へ遷移し、状態/権限が更新される

- **シナリオ2**: 日報作成（基本情報の保存が必須）
  - 日報画面で日付/シフト/エリアを選択（日付はカレンダー選択）
  - 基本情報の保存後に他機能が解放される
  - 同一 日付+シフト+エリア は同一日報として上書き

- **シナリオ3**: 出勤/設備/ロットの入力
  - 出勤は正社員/契約社員を同一画面で入力
  - 設備異常/ロット異常は複数記録を追加して保存

- **シナリオ4**: 出勤統計と異常履歴の照会
  - 出勤統計は表とグラフを表示（期間は当月1日〜本日が既定）
  - 異常履歴は設備/ロットの二表で、期間とシフト/エリアで絞り込み

- **シナリオ5**: 管理機能
  - 管理者はユーザー、翻訳リソース、シフト/エリア、設定を管理

### テスト重点
- 言語切替が即時反映されること
- 基本情報未保存時に他機能が操作不可であること
- 同一 日付+シフト+エリア で日報が上書きされること
- 出勤統計と異常履歴の期間既定が当月1日〜本日であること
- 異常履歴のシフト/エリア絞り込みが有効であること

## 3. 機能要件 (Functional Requirements)

### FR1: 言語切替
- 日/中/英の 3 言語に対応
- 言語切替後に UI 文言が即時更新
- 言語選択は同一セッション内で保持

### FR2: ユーザー認証
- ログイン画面でアカウント認証
- パスワードは bcrypt でハッシュ保存
- 管理者/一般ユーザー権限を区別

### FR3: 日報と基本情報ゲート
- 日報には日付/シフト/エリア/サマリー欄を含む
- 基本情報を保存するまで他機能をロック
- 同一 日付+シフト+エリア を同一日報として上書き

### FR4: 出勤記録
- 正社員/契約社員の定員・出勤・欠勤・理由を同一ページで入力
- 出勤データは日報に紐づけて保存

### FR5: 設備異常
- 設備番号、異常内容、発生時刻、影響数、対応内容、画像パス（任意）を記録
- 設備異常は日報に紐づけて保存

### FR6: 異常ロット
- ロット番号、異常内容、処置状況、特記事項を記録
- 異常ロットは日報に紐づけて保存

### FR7: 管理機能
- 管理者はユーザーと翻訳リソースを管理
- 管理者はシフト/エリアの追加・更新・削除が可能
- システム設定でバックアップ間隔を保存

### FR8: 出勤統計（総結）
- 期間指定（既定：当月1日〜本日）
- 出勤統計表（日時/エリア/記入者/正社員/契約社員/備考）
- 出勤率折線図と出勤人数の積み上げ棒グラフ

### FR9: 異常履歴照会
- 期間指定（既定：当月1日〜本日）
- シフト/エリア絞り込み
- 設備異常/異常ロットの入力詳細を表で表示

### FR10: Delay List / Summary Actual
- Excel インポート → 仮保存 → アップロード
- 日付範囲で検索と編集が可能

### FR11: テーマ切替
- ライト/ダークの切替を提供
- 切替後に主要 UI が即時反映
- テーマ設定を保存し次回起動時に適用

## 4. 非機能要件 (Non-Functional Requirements)

### NFR1: 性能
- 言語切替は 500ms 未満
- 日報の保存/読み込みは 1 秒以内

### NFR2: 可用性
- 操作フローが明確で、ログイン後に導線で操作できる
- フォーム/表に明確な見出しとヒントを表示

### NFR3: 信頼性
- 言語切替でクラッシュやデータ消失が起きない
- 翻訳が欠落した場合は既定文言にフォールバック

### NFR4: セキュリティ
- パスワードは bcrypt ハッシュ
- 管理機能は管理者のみ利用可能

## 5. 成功基準 (Success Criteria)

- [ ] 基本情報未保存時に他ページが操作不可
- [ ] 出勤統計/異常履歴の期間既定が当月1日〜本日
- [ ] 言語切替後に全 UI が即時更新
- [ ] 出勤/設備/ロットが正しく保存され日報に紐づく
- [ ] 管理者がユーザー/シフト/エリアを管理できる
- [ ] テーマ切替が即時反映され、設定が保存される

## 6. 主要エンティティ (Key Entities)

- **ユーザー (User)**：ユーザー名、パスワードハッシュ、ロール
- **日報 (Daily Report)**：日付、シフト、エリア、記入者、サマリー欄
- **出勤記録 (Attendance Entry)**：正社員/契約社員の出勤データ
- **設備異常 (Equipment Log)**：設備異常の詳細
- **異常ロット (Lot Log)**：ロット異常の詳細

## 7. 依存関係と前提 (Dependencies & Assumptions)

### 依存関係
- SQLite ローカル DB
- Python 3.9+ と Tkinter

### 前提
- 利用者は基本的な PC 操作が可能
- システムはオフラインで運用

## 8. エッジケース (Edge Cases)

- 翻訳欠落時は既定文言にフォールバック
- 日付範囲が不正（終了日 < 開始日）ならエラー提示
- 数値入力が不正な場合はエラー表示
