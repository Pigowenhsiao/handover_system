# 出勤記録機能の改善仕様 (Attendance Record Enhancement Specification)

## 1. 概要 (Overview)

出勤記録機能を改善し、正社員（Regular）と契約社員（Contract）を同一画面で同時入力できるようにする。職種をドロップダウンで切替せずに入力でき、操作を簡素化して入力効率を高める。

## 2. ユーザーシナリオとテスト (User Scenarios & Testing)

### 主要シナリオ
- **シナリオ1**: 出勤記録の入力
  - 出勤記録ページを開く
  - 正社員/契約社員の入力欄が同一画面に表示される
  - 定員/出勤/欠勤/理由を同時に入力できる
  - 職種切替は不要

- **シナリオ2**: 過去の出勤記録の確認
  - 過去の出勤記録を閲覧
  - 正社員/契約社員のデータが同時に表示される
  - 種別ごとに明確に区分される

### テストケース
- 同一画面で正社員/契約社員の出勤が入力できる
- データが正しく保存/検索できる
- 画面上で両者の欄が明確に区別される
- 履歴データが正しく表示される

## 3. 機能要件 (Functional Requirements)

### FR1: 職種の同時表示
- 正社員と契約社員の入力欄を同一画面に表示
- ドロップダウンによる職種切替は不要
- 各職種に定員/出勤/欠勤/理由の欄を用意

### FR2: 入力機能
- 正社員/契約社員のデータを独立して入力可能
- 出勤+欠勤=定員の整合性チェック（特例は除く）
- 各職種の理由を記録

### FR3: 保存と検索
- 正社員/契約社員の記録を正しく保存
- 日報に正しく紐づけ
- 履歴の閲覧に対応

### FR4: UI 設計
- 正社員/契約社員の入力領域を明確に分離
- ラベルに職種名を明記
- 両職種の入力に十分なスペースを確保

### FR5: データ検証
- 数値入力の妥当性を検証
- 出勤/欠勤が定員を超えないことを確認
- 日付形式の正当性を確認

## 4. 非機能要件 (Non-Functional Requirements)

### NFR1: 可用性 (Usability)
- 直感的で追加の教育が不要
- ラベルが明確で理解しやすい
- 操作ミス時に適切なフィードバックを表示

### NFR2: 性能 (Performance)
- ページ表示は 2 秒未満
- 保存操作は 1 秒以内
- 履歴検索は 3 秒以内（大量データ時）

### NFR3: 信頼性 (Reliability)
- 保存処理にトランザクション性を持たせる
- データ破損や喪失を防止

## 10. レポート操作要件 (Report Interaction)

### FR6: 出勤レポートのダブルクリック操作
- 明細行をダブルクリックすると編集ダイアログを開き、定員/出勤/欠勤/理由の更新と削除が可能
- 集計行のダブルクリックは閲覧のみで編集/削除不可
- 更新/削除後は再読み込みして最新状態を表示

## 5. 成功基準 (Success Criteria)

- [ ] 正社員/契約社員を同一画面で同時入力できる
- [ ] 2 種類の出勤データが正しく保存される
- [ ] UI の応答が 500ms 未満
- [ ] 検証失敗時は送信を止め、明確なエラーメッセージを表示
- [ ] 保存成功率 100%
- [ ] 入力完了時間が 30% 以上短縮
- [ ] 利用者満足度 90% 以上

## 6. 主要エンティティ (Key Entities)

- **出勤記録**：ID、報表ID、職種、定員/出勤/欠勤/理由
- **日報**：日付、シフト、エリアなど、出勤記録と関連

## 7. 依存関係と前提 (Dependencies & Assumptions)

### 依存関係
- 既存の日報機能
- 既存の出勤記録機能
- Tkinter の UI 構成

### 前提
- 既存の DB 構造が要件を満たす
- 利用者が基本入力操作に慣れている
- 既存の検証機構を拡張可能

## 8. エッジケース (Edge Cases)

- 片方の職種が 0 名の場合も処理できる
- 出勤 > 定員などの不正入力はエラー表示
- 大量データでも UI が表示/操作可能
- エラー時にデータが失われない

## 9. 合意済み事項 (Clarifications)

### 2025-11-25 会議決定
- **Q**: 検証レベルは？
  - **A**: 出勤+欠勤≤定員を必須条件とする
- **Q**: UI 設計は？
  - **A**: 既存 UI と整合し、体験の連続性を保つ
- **Q**: 言語リソースのキャッシュ戦略は？
  - **A**: ローカル JSON を使用し、切替時に即時読み込み
